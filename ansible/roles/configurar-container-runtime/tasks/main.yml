- name: "Configurações k8s"    
  become: true
  ansible.builtin.shell:
    cmd: |
      cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf
      overlay
      br_netfilter
      EOF
- name: "modprobe"
  become: true
  ansible.builtin.shell:
    cmd: modprobe overlay && modprobe br_netfilter
- name: "Configurações k8s network"    
  become: true
  ansible.builtin.shell:
    cmd: |
      cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
      net.bridge.bridge-nf-call-iptables  = 1
      net.bridge.bridge-nf-call-ip6tables = 1
      net.ipv4.ip_forward                 = 1
      EOF 
  notify: 
    -  Apply sysctl params without reboot
- name: Configurar cgroup driver para usar systemd
  become: true
  ansible.builtin.shell:
    cmd: |
      cat <<EOF | sudo tee /etc/containerd/config.toml
      [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]
          SystemdCgroup = true
      EOF
  notify:
    - Reiniciar containerd